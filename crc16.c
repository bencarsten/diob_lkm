static unsigned short crc16_table[256] = {
    0x0000, 0xdc77, 0x2837, 0xf440, 0x506e, 0x8c19, 0x7859, 0xa42e, 
    0xa0dc, 0x7cab, 0x88eb, 0x549c, 0xf0b2, 0x2cc5, 0xd885, 0x04f2, 
    0xd161, 0x0d16, 0xf956, 0x2521, 0x810f, 0x5d78, 0xa938, 0x754f, 
    0x71bd, 0xadca, 0x598a, 0x85fd, 0x21d3, 0xfda4, 0x09e4, 0xd593, 
    0x321b, 0xee6c, 0x1a2c, 0xc65b, 0x6275, 0xbe02, 0x4a42, 0x9635, 
    0x92c7, 0x4eb0, 0xbaf0, 0x6687, 0xc2a9, 0x1ede, 0xea9e, 0x36e9, 
    0xe37a, 0x3f0d, 0xcb4d, 0x173a, 0xb314, 0x6f63, 0x9b23, 0x4754, 
    0x43a6, 0x9fd1, 0x6b91, 0xb7e6, 0x13c8, 0xcfbf, 0x3bff, 0xe788, 
    0x6436, 0xb841, 0x4c01, 0x9076, 0x3458, 0xe82f, 0x1c6f, 0xc018, 
    0xc4ea, 0x189d, 0xecdd, 0x30aa, 0x9484, 0x48f3, 0xbcb3, 0x60c4, 
    0xb557, 0x6920, 0x9d60, 0x4117, 0xe539, 0x394e, 0xcd0e, 0x1179, 
    0x158b, 0xc9fc, 0x3dbc, 0xe1cb, 0x45e5, 0x9992, 0x6dd2, 0xb1a5, 
    0x562d, 0x8a5a, 0x7e1a, 0xa26d, 0x0643, 0xda34, 0x2e74, 0xf203, 
    0xf6f1, 0x2a86, 0xdec6, 0x02b1, 0xa69f, 0x7ae8, 0x8ea8, 0x52df, 
    0x874c, 0x5b3b, 0xaf7b, 0x730c, 0xd722, 0x0b55, 0xff15, 0x2362, 
    0x2790, 0xfbe7, 0x0fa7, 0xd3d0, 0x77fe, 0xab89, 0x5fc9, 0x83be, 
    0xc86c, 0x141b, 0xe05b, 0x3c2c, 0x9802, 0x4475, 0xb035, 0x6c42, 
    0x68b0, 0xb4c7, 0x4087, 0x9cf0, 0x38de, 0xe4a9, 0x10e9, 0xcc9e, 
    0x190d, 0xc57a, 0x313a, 0xed4d, 0x4963, 0x9514, 0x6154, 0xbd23, 
    0xb9d1, 0x65a6, 0x91e6, 0x4d91, 0xe9bf, 0x35c8, 0xc188, 0x1dff, 
    0xfa77, 0x2600, 0xd240, 0x0e37, 0xaa19, 0x766e, 0x822e, 0x5e59, 
    0x5aab, 0x86dc, 0x729c, 0xaeeb, 0x0ac5, 0xd6b2, 0x22f2, 0xfe85, 
    0x2b16, 0xf761, 0x0321, 0xdf56, 0x7b78, 0xa70f, 0x534f, 0x8f38, 
    0x8bca, 0x57bd, 0xa3fd, 0x7f8a, 0xdba4, 0x07d3, 0xf393, 0x2fe4, 
    0xac5a, 0x702d, 0x846d, 0x581a, 0xfc34, 0x2043, 0xd403, 0x0874, 
    0x0c86, 0xd0f1, 0x24b1, 0xf8c6, 0x5ce8, 0x809f, 0x74df, 0xa8a8, 
    0x7d3b, 0xa14c, 0x550c, 0x897b, 0x2d55, 0xf122, 0x0562, 0xd915, 
    0xdde7, 0x0190, 0xf5d0, 0x29a7, 0x8d89, 0x51fe, 0xa5be, 0x79c9, 
    0x9e41, 0x4236, 0xb676, 0x6a01, 0xce2f, 0x1258, 0xe618, 0x3a6f, 
    0x3e9d, 0xe2ea, 0x16aa, 0xcadd, 0x6ef3, 0xb284, 0x46c4, 0x9ab3, 
    0x4f20, 0x9357, 0x6717, 0xbb60, 0x1f4e, 0xc339, 0x3779, 0xeb0e, 
    0xeffc, 0x338b, 0xc7cb, 0x1bbc, 0xbf92, 0x63e5, 0x97a5, 0x4bd2
};

unsigned short crc16_from_pointer(const void* p)
{
    const unsigned char *puc = (const unsigned char*)p;
    int k;

    unsigned short crc = 0;
    for (k = 0; k < sizeof(p); k++)
        crc = crc16_table[(crc ^ *puc++) & 0xff];
    return crc;
}
